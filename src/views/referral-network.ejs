<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Реферальная таблица</title>
	<meta name="user-referal-id" content="<%= typeof userReferalId !== 'undefined' ? userReferalId : '' %>">
	<meta name="api-readonly-key" content="<%= process.env.API_READONLY_KEY || '' %>">
	<link rel="stylesheet" href="/css/style.css?v=<%= new Date().getTime() %>">
</head>

<body>
	<div class="container">
		<div class="header">
			<h1>
				<%= typeof userReferalId !=="undefined" ? `Приглашенные пользователя (${userReferalId})`
					: "Список приглашенных" %>
			</h1>
		</div>
		<div class="stats-bar-container">
			<div class="stats-bar" id="statsBar" style="display: none;">
				<div class="stat-item">
					<span class="stat-label">Приглашено:</span>
					<span class="stat-value" id="totalReferrals">0</span>
				</div>
				<div class="stat-item">
					<span class="stat-label">Активных:</span>
					<span class="stat-value" id="activeReferrals">0</span>
				</div>
				<div class="stat-item">
					<span class="stat-label">Неактивных:</span>
					<span class="stat-value" id="inactiveReferrals" style="color: #ef4444;">0</span>
				</div>
				<div class="stat-item">
					<span class="stat-label">Уровней:</span>
					<span class="stat-value" id="maxLevels">0</span>
				</div>
				<div class="stat-item">
					<span class="stat-label">Новая регистрация:</span>
					<span class="stat-value" id="lastRegistration">—</span>
				</div>
			</div>
			<div class="search-container">
				<input type="text" id="searchInput" class="search-input" placeholder="Поиск по всем полям...">
				<button id="clearSearch" class="search-clear" disabled>Очистить</button>
				<div class="expand-controls">
					<button id="refreshBtn" class="refresh-btn" title="Обновить таблицу">
						<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path
								d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
								stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
						</svg>
						Обновить
					</button>
					<button id="toggleExpand" class="toggle-expand-btn">Раскрыть все</button>
				</div>
			</div>
		</div>

		<div class="table-container">
			<table class="referral-table">
				<thead class="table-header">
					<tr>
						<th>Структура</th>
						<th>Дата регистрации</th>
						<th>Никнейм реферала</th>
						<th>Имя реферала</th>
						<th>Никнейм пригласителя</th>
						<th>Активность в канале</th>
					</tr>
				</thead>
				<tbody id="tableBody">
					<tr>
						<td colspan="6" class="loading">
							<div class="loading-spinner"></div>
							Загрузка данных...
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<script src="/js/script.js?v=<%= new Date().getTime() %>"></script>
</body>

</html>