# Исправление подсчета количества рефералов

## Проблема
Ранее подсчет количества рефералов в структуре работал некорректно. Вместо подсчета всех потомков (дочерних элементов до самой глубины), система считала неправильно, включая лишние элементы.

## Решение
Создана новая функция `countAllDescendants()` в сервисе рефералов, которая правильно подсчитывает всех потомков:

### Логика подсчета:
1. **Исключаем родителя** - сам родительский элемент не считается
2. **Считаем всех потомков** - включаем детей, внуков, правнуков и т.д.
3. **Рекурсивный подсчет** - проходим по всему дереву до самой глубины

### Код функции:
```javascript
countAllDescendants(children) {
    if (!children || children.length === 0) {
        return 0;
    }

    let totalCount = 0;
    for (const child of children) {
        // Считаем самого ребенка
        totalCount += 1;
        // Рекурсивно считаем всех его потомков
        totalCount += this.countAllDescendants(child.children);
    }
    return totalCount;
}
```

### Пример правильного подсчета:
Для структуры как на картинке:
- **Родитель (14)** → должен показывать **7** (все потомки)
- **Ребенок (4)** → должен показывать **2** (его потомки)
- **Внук (2)** → должен показывать **1** (его потомок)
- **Правнук (0)** → должен показывать **0** (нет потомков)

## Изменения в коде

### Файл: `src/services/referal.service.js`
1. Добавлена функция `countAllDescendants()`
2. Изменена логика в `getReferalTree()`:
   ```javascript
   // Было:
   const totalReferals = children.reduce((sum, child) => sum + (child.totalReferals || 0) + 1, children.length);
   
   // Стало:
   const totalReferals = this.countAllDescendants(children);
   ```

## Проверка работы
После внесения изменений:
1. Перезапущен сервер
2. API возвращает правильные значения `totalReferals`
3. Веб-интерфейс отображает корректные цифры

## Результат
Теперь в столбце "Структура" после статуса (например, "УР2") отображается правильное количество всех потомков в структуре, исключая самого родителя.
